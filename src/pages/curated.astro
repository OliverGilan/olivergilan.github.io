---
import { getCollection, render } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import SpotifyEmbed from "../components/SpotifyEmbed.astro";

const books = await getCollection("books");
const essays = await getCollection("essays");
const blogs = await getCollection("blogs");
---

<BaseLayout title="Curated" description="Curated lists of blogs, essays, and music.">
  <div class="not-prose">
    <p class="text-ink-light text-md italic mb-8">Curated lists of my favorite books, blogs, essays, and music.</p>
      <!-- Music -->
      <div class="h-8" />
      <section>
        <div class="flex items-center gap-4 mb-4">
          <h2 class="text-sm font-sans font-semibold text-ink-light uppercase tracking-widest">
            Music
          </h2>
          <div class="flex-1 h-px bg-ink/10"></div>
        </div>
        <SpotifyEmbed id="56fWREjDvv37m3K1EuLLrm" />
      </section>

      <!-- Blogs -->
      {blogs.length > 0 && (
        <>
          <div class="h-8" />
          <section>
            <div class="flex items-center gap-4 mb-4">
              <h2 class="text-sm font-sans font-semibold text-ink-light uppercase tracking-widest">
                Blogs
              </h2>
              <div class="flex-1 h-px bg-ink/10"></div>
            </div>
            
            <ul class="pl-4 pb-4">
              {blogs.map(async (item) => {
                const { Content } = await render(item);
                const hasContent = item.body && item.body.trim().length > 0;
                return (
                  <li class="group py-1.5">
                    <div class="flex flex-col">
                      <div class="flex items-baseline gap-2">
                        <a
                          href={item.data.href}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="text-ink group-hover:text-accent transition-colors duration-150 underline decoration-ink/20 underline-offset-2"
                        >
                          {item.data.title}
                        </a>
                      </div>
                      {hasContent && (
                        <div class="text-sm text-ink-light/70 mt-1 prose prose-sm max-w-none">
                          <Content />
                        </div>
                      )}
                    </div>
                  </li>
                );
              })}
            </ul>
          </section>
        </>
      )}

      <!-- Books -->
      {books.length > 0 && (
        <section>
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-sm font-sans font-semibold text-ink-light uppercase tracking-widest">
              Books
            </h2>
            <div class="flex-1 h-px bg-ink/10"></div>
          </div>
          
          <ul class="pl-4 pb-4">
            {books.map(async (item) => {
              const { Content } = await render(item);
              const hasContent = item.body && item.body.trim().length > 0;
              return (
                <li class="group py-1.5">
                  <div class="flex flex-col">
                    <div class="flex items-baseline gap-2">
                      <span class="text-ink">{item.data.title}</span>
                      {item.data.author && (
                        <span class="text-sm text-ink-light/60">
                          {item.data.author}
                        </span>
                      )}
                    </div>
                    {hasContent && (
                      <div class="text-sm text-ink-light/70 mt-1 prose prose-sm max-w-none">
                        <Content />
                      </div>
                    )}
                  </div>
                </li>
              );
            })}
          </ul>
        </section>
      )}

      <!-- Essays -->
      {essays.length > 0 && (
        <>
          <div class="h-8" />
          <section>
            <div class="flex items-center gap-4 mb-4">
              <h2 class="text-sm font-sans font-semibold text-ink-light uppercase tracking-widest">
                Essays
              </h2>
              <div class="flex-1 h-px bg-ink/10"></div>
            </div>
            
            <ul class="pl-4 pb-4">
              {essays.map(async (item) => {
                const { Content } = await render(item);
                const hasContent = item.body && item.body.trim().length > 0;
                return (
                  <li class="group py-1.5">
                    <div class="flex flex-col">
                      <div class="flex items-baseline gap-2">
                        <a
                          href={item.data.href}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="text-ink group-hover:text-accent transition-colors duration-150 underline decoration-ink/20 underline-offset-2"
                        >
                          {item.data.title}
                        </a>
                        {item.data.author && (
                          <span class="text-sm text-ink-light/60">
                            {item.data.author}
                          </span>
                        )}
                        
                      </div>
                      {hasContent && (
                        <div class="text-sm text-ink-light/70 mt-1 prose prose-sm max-w-none">
                          <Content />
                        </div>
                      )}
                    </div>
                  </li>
                );
              })}
            </ul>
          </section>
        </>
      )}
  </div>
</BaseLayout>
