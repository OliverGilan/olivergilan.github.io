---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const books = await getCollection('books', ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  });
  
  return books.map((book) => ({
    params: { slug: book.slug },
    props: { book },
  }));
}

const { book } = Astro.props;
const { Content } = await book.render();
---

<BaseLayout 
  title={`${book.data.title} - Oliver Gilan`}
  description={`Book notes on ${book.data.title}`}
  currentPath={`/books/${book.slug}`}
>
  <article>
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4">{book.data.title}</h1>
      {book.data.author && (
        <p class="text-xl text-gray-600 mb-2">by {book.data.author}</p>
      )}
      {book.data.genre && (
        <span class="inline-block text-sm bg-gray-100 text-gray-700 px-3 py-1 rounded">
          {book.data.genre}
        </span>
      )}
    </header>
    
    <div class="prose prose-lg max-w-none">
      <Content />
    </div>
  </article>
</BaseLayout>
